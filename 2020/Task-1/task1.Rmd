---
params:
   task_nr: 1
   year: 2020
title: '`r paste("<span>Task", params$task_nr, "<span class = \"back\"><a href = \"index.html\">", fontawesome::fa("home"), "</a></span></span>")`'
author: 
  name: "Thorn Thaler"
  email: "thorn.thaler@thothal.at"
date: "`r Sys.Date()`"
knit: (function(inputFile, encoding) {
   year <- basename(dirname(dirname(inputFile)))
   
   o_file <- sprintf("%s_%s", year, 
                     tools::file_path_sans_ext(basename(inputFile)))
                     
   rmarkdown::render(inputFile, encoding = encoding, 
                     output_file = o_file, output_dir = here::here("docs"))
   })
output: 
  rmdformats::downcute:
    highlight: tango
    use_bookdown: TRUE
    mathjax: NULL
    lightbox: TRUE
    gallery: TRUE
editor_options: 
  chunk_output_type: console
---

```{css custom-css, echo = FALSE}
.page-content  .figure {
  width: 100%;
}

.back {
  font-size: 2rem;
}

.day-desc {
  border: 2px dotted;
  border-radius: 6px;
  border-color: var(--blockquote-border-color);
  padding: 0 20px;
}
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, fig.align = "center",
                      dev.args = list(bg = "transparent"))
## Define a function to write text in typewriter font
tt <- function(x) {
  if (knitr::is_latex_output()) {
    sprintf("\\texttt{%s}", as.character(x))
  } else if (knitr::is_html_output()) {
    sprintf("<tt>%s</tt>", as.character(x))
  } else {
    x
  }
}

```

# Setup

## Libraries

```{r libs, warning = FALSE}
library(httr)
library(xml2)
library(magrittr)
library(dplyr)
library(purrr)
library(stringr)
```

## Retrieve Data from `r tt("AoC")`


```{r get-data, cache = FALSE, messages = FALSE}
session_cookie <- set_cookies(session = keyring::key_get("AoC-GitHub-Cookie"))
base_url <- paste0("https://adventofcode.com/", params$year, "/day/", params$task_nr)
puzzle <- GET(base_url,
              session_cookie) %>% 
  content(encoding = "UTF-8") %>% 
  xml_find_all("///article") %>% 
  lapply(as.character)

parse_puzzle_data <- function(text_block = readClipboard()) {
  if (length(text_block) == 1L) {
    text_block <- text_block %>% 
      str_split("\n") %>% 
      extract2(1L) %>% 
      keep(nzchar)
  }
  text_block %>% 
    as.integer()
}

puzzle_data <- local({
  GET(paste0(base_url, "/input"),
      session_cookie) %>% 
    content(encoding = "UTF-8") %>% 
    parse_puzzle_data()
})
```

```{r example-data, eval = interactive(), echo = FALSE}
```

# Puzzle Day `r params$task_nr`

## Part 1

### Description

```{r show-puzzle-a, echo = FALSE, results = "asis"}
cat(puzzle[[1]])
```

### Solution

Hohoho! Welcome to this year's AoC. Let the games begin (again). 

For this puzzle we simply need to find the two numbers that sum up to 2020. We sort the
list beforehand and work with a pointer on the left and the right and move them 
accordingly.


```{r get-solution-1}
find_pair <- function(nrs = puzzle_data, target = 2020L) {
  nrs <- sort(nrs)
  i <- 1L
  j <- length(nrs)
  while (i < j) {
    s <- nrs[i] + nrs[j]
    if (s == target) {
      return(nrs[i] * nrs[j])
    } else if (s < target) {
      i <- i + 1L
    } else { # s > target
      j <- j - 1L
    }
  }
  NA_integer_
}
find_pair(puzzle_data)
```

## Part 2

### Description

```{r show-puzzle-b, echo = FALSE, results = "asis", eval = length(puzzle) > 1}
cat(puzzle[[2]])
```

### Solution

Pretty much the same as part 1, but this time we need to find a triple satisfying the 
condition. We fix the first number and use the same idea as in part 1 with the two 
pointers.

```{r get-solution-2}
find_triple <- function(nrs = puzzle_data, target = 2020L) {
  nrs <- sort(nrs)
  n <- length(nrs)
  for (i in 1L:(n - 2L)) {
    a <- nrs[i]
    l <- i + 1L
    r <- n
    while (l < r) {
      s <- a + nrs[l] + nrs[r]
      if (s == target) {
        return(a * nrs[l] * nrs[r])
      } else if (s < target) {
        l <- l + 1L
      } else { # s > target
        r <- r - 1L
      }
    }
  }
  NA_integer_
}

find_triple(puzzle_data)
```
