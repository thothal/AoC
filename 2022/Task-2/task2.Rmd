---
params:
   task_nr: 2
   year: 2022
title: '`r paste("<span>Task", params$task_nr, "<span class = \"back\"><a href = \"index.html\">", fontawesome::fa("home"), "</a></span></span>")`'
author: 
  name: "Thorn Thaler"
  email: "thorn.thaler@thothal.at"
date: "`r Sys.Date()`"
knit: (function(inputFile, encoding) {
   year <- basename(dirname(dirname(inputFile)))
   
   o_file <- sprintf("%s_%s", year, 
                     tools::file_path_sans_ext(basename(inputFile)))
                     
   rmarkdown::render(inputFile, encoding = encoding, 
                     output_file = o_file, output_dir = here::here("docs"))
   })
output: 
  rmdformats::downcute:
    highlight: tango
    use_bookdown: TRUE
    mathjax: NULL
    lightbox: TRUE
    gallery: TRUE
editor_options: 
  chunk_output_type: console
---

```{css custom-css, echo = FALSE}
.page-content  .figure {
  width: 100%;
}

.back {
  font-size: 2rem;
}

.day-desc {
  border: 2px dotted;
  border-radius: 6px;
  border-color: var(--blockquote-border-color);
  padding: 0 20px;
}
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, fig.align = "center",
                      dev.args = list(bg = "transparent"))
## Define a function to write text in typewriter font
tt <- function(x) {
  if (knitr::is_latex_output()) {
    sprintf("\\texttt{%s}", as.character(x))
  } else if (knitr::is_html_output()) {
    sprintf("<tt>%s</tt>", as.character(x))
  } else {
    x
  }
}

```

# Setup

## Libraries

```{r libs, warning = FALSE}
library(httr)
library(xml2)
library(magrittr)
library(dplyr)
library(purrr)
library(stringr)
```

## Retrieve Data from `r tt("AoC")`


```{r get-data, cache = FALSE, messages = FALSE}
session_cookie <- set_cookies(session = keyring::key_get("AoC-GitHub-Cookie"))
base_url <- paste0("https://adventofcode.com/", params$year, "/day/", params$task_nr)
puzzle <- GET(base_url,
              session_cookie) %>% 
  content(encoding = "UTF-8") %>% 
  xml_find_all("///article") %>% 
  lapply(as.character)

parse_puzzle_data <- function(text_block = readClipboard()) {
  if (length(text_block) == 1L) {
    text_block <- text_block %>% 
      str_split("\n") %>% 
      extract2(1L) %>% 
      keep(nzchar)
  }
  text_block %>% 
    str_split(" ") %>% 
    do.call(rbind, .) %>% 
    set_colnames(c("you", "me")) %>% 
    as_tibble()
}

puzzle_data <- local({
  GET(paste0(base_url, "/input"),
      session_cookie) %>% 
    content(encoding = "UTF-8") %>% 
    parse_puzzle_data()
})
```

```{r example-data, eval = interactive(), echo = FALSE}
```

# Puzzle Day `r params$task_nr`

## Part 1

### Description

```{r show-puzzle-a, echo = FALSE, results = "asis"}
cat(puzzle[[1]])
```

### Solution

We calculate the points from the original assignment by joining a table with the outcome 
for each pair and summing game and sign points.

```{r get-solution-1}
count_points <- function(strategy) {
  ## A/X rock
  ## B/Y paper
  ## C/Z scissors 
  pts <- expand.grid(you = LETTERS[1:3], me = LETTERS[24:26], 
                     stringsAsFactors = FALSE) %>% 
    as_tibble() %>% 
    mutate(
      game_pts = case_when(
        you == "A" & me == "X" |
          you == "B" & me == "Y" |
          you == "C" & me == "Z" ~ 3L,
        you == "A" & me == "Y" |
          you == "B" & me == "Z" |
          you == "C" & me == "X" ~ 6L,
        .default = 0L),
      sign_pts = case_when(
        me == "X" ~ 1L,
        me == "Y" ~ 2L,
        me == "Z" ~ 3L
      ),
      points = sign_pts + game_pts
    )
  strategy %>% 
    inner_join(
      pts, c("you", "me")
    ) %>% 
    summarize(points = sum(points)) %>% 
    pull(points)
}

count_points(puzzle_data)
```

## Part 2

### Description

```{r show-puzzle-b, echo = FALSE, results = "asis", eval = length(puzzle) > 1}
cat(puzzle[[2]])
```

The game poins can be dreived directly from the second column. For the sign points we need
to determine which sign we are playing given the outcome and the sign from the opponent.

### Solution

```{r get-solution-2}
count_points2 <- function(strategy) {
  ## A/X rock
  ## B/Y paper
  ## C/Z scissors 
  pts <- strategy  %>% 
    mutate(
      game_pts = case_when(
        me == "X" ~ 0L,
        me == "Y" ~ 3L,
        me == "Z" ~ 6L
      ),
      sign_pts = case_when(
        you == "A" & me == "Y" |
          you == "B" & me == "X" |
          you == "C" & me == "Z" ~ 1L,
        you == "A" & me == "Z" |
          you == "B" & me == "Y" |
          you == "C" & me == "X" ~ 2L,
        you == "A" & me == "X" |
          you == "B" & me == "Z" |
          you == "C" & me == "Y" ~ 3L
      ),
      points = sign_pts + game_pts
    )
  pts %>% 
    summarize(points = sum(points)) %>% 
    pull(points)
}

count_points2(puzzle_data)
```
